<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Histórico de Atendimentos</title>
    <link rel="stylesheet" href="../templates/historico_medico.css"> 
    <link rel="shortcut icon" href="../imagens/ico.ico" type="image/x-icon">
</head>
<body>
    <div class="dashboard-container">
        <div class="header-medico">
            <h2>Meu Histórico de Atendimentos</h2>
            <a href="dashbord_medico.html">Voltar</a>
        </div>
        
        <div class="content">
            <p>Aqui está uma lista de todos os atendimentos que você já realizou.</p>
            
            <div id="lista-historico-medico">
                <p>Carregando histórico...</p>
            </div>
        </div>
    </div>
    <script src="../templates/config.js"></script>
    <script>
<<<<<<< HEAD
=======
        const API_URL = 'http:/192.168.1.14:5000'; // ⚠️ MUDE SE O IP MUDAR

>>>>>>> 9a20be09c85f1ddcd529a29c3290926e17c278b1
        document.addEventListener('DOMContentLoaded', () => {
            
            const medicoId = localStorage.getItem('medico_id');
            if (!medicoId) {
                alert('Erro: Médico não identificado. Faça login.');
                window.location.href = '../index.html';
                return;
            }

            const containerHistorico = document.getElementById('lista-historico-medico');
            
            // Chama a NOVA ROTA da API
            fetch(`${API_URL}/api/relatorios/historico_medico/${medicoId}`)
                .then(response => response.json())
                .then(data => {
                    containerHistorico.innerHTML = ''; // Limpa "Carregando..."
                    if (data.length === 0) {
                        containerHistorico.innerHTML = '<p>Nenhum atendimento encontrado no histórico.</p>';
                        return;
                    }

                    data.forEach(atendimento => {
                        const card = document.createElement('div');
                        // Adiciona classes do seu CSS
                        card.className = 'card-atendimento pago'; 
                        
                        const dataFormatada = new Date(atendimento.data_atendimento).toLocaleString('pt-BR');

                        card.innerHTML = `
                            <strong>Data:</strong> ${dataFormatada}<br>
                            <strong>Paciente:</strong> ${atendimento.NomePaciente} (CPF: ${atendimento.CpfPaciente})<br>
                            <strong>Observações:</strong> ${atendimento.observacoes}
                        `;
                        containerHistorico.appendChild(card);
                    });
                })
                .catch(error => {
                    console.error('Erro ao carregar histórico:', error);
                    containerHistorico.innerHTML = '<p style="color: red;">Erro ao carregar histórico.</p>';
                });
        });
    </script>
</body>
</html>
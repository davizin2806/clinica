<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Cadastrar Novo Paciente</title>
    <link rel="stylesheet" href="../templetes/cadastrar_paciente.css" /> 
    <link rel="shortcut icon" href="../imagens/ico.ico" type="image/x-icon">
</head>
<body>
    <div class="box">
        <form id="formCadastrarPaciente">
            <fieldset>
                <legend>Cadastrar Novo Paciente</legend>

                <div class="input_box">
                    <label for="nome" class="static_label">Nome Completo:</label>
                    <input type="text" id="nome" name="nome" class="input_user" required />
                </div>
                <div class="input_box">
                    <label for="cpf" class="static_label">CPF:</label>
                    <input type="text" id="cpf" name="cpf" class="input_user" required />
                </div>
                <div class="input_box">
                    <label for="data_nascimento" class="static_label">Data de Nascimento:</label>
                    <input type="date" id="data_nascimento" name="data_nascimento" required />
                </div>
                <div class="input_box">
                    <label for="telefone" class="static_label">Telefone:</label>
                    <input type="text" id="telefone" name="telefone" class="input_user" />
                </div>
                <div class="input_box">
                    <label for="email" class="static_label">Email:</label>
                    <input type="email" id="email" name="email" class="input_user" />
                </div>
                <div class="input_box">
                    <label for="convenio" class="static_label">Convênio do Paciente:</label>
                    <select id="convenio" name="convenio">
                        <option value="">Nenhum / Particular</option>
                        <option value="1">Convenio Teste (Unimed)</option> 
                    </select>
                </div>

                <hr>
                
                <div class="input_box">
                    <label for="cep" class="static_label">CEP:</label>
                    <input type="text" id="cep" name="cep" class="input_user" required />
                </div>
                <div class="input_box">
                    <label for="logradouro" class="static_label">Logradouro (Rua/Av.):</label>
                    <input type="text" id="logradouro" name="logradouro" class="input_user" required />
                </div>
                <div class="input_box">
                    <label for="numero" class="static_label">Número:</label>
                    <input type="text" id="numero" name="numero" class="input_user" />
                </div>
                <div class="input_box">
                    <label for="complemento" class="static_label">Complemento:</label>
                    <input type="text" id="complemento" name="complemento" class="input_user" />
                </div>
                <div class="input_box">
                    <label for="bairro" class="static_label">Bairro:</label>
                    <input type="text" id="bairro" name="bairro" class="input_user" required />
                </div>
                <div class="input_box">
                    <label for="cidade" class="static_label">Cidade:</label>
                    <input type="text" id="cidade" name="cidade" class="input_user" required />
                </div>
                <div class="input_box">
                    <label for="estado" class="static_label">Estado (Sigla, ex: ES):</label>
                    <input type="text" id="estado" name="estado" class="input_user" required maxlength="2" />
                </div>

                <input type="submit" class="btn-submit" value="Salvar Cadastro" />
                <a href="dashbord_medico.html" class="btn-cancel">Cancelar e Voltar</a>
            </fieldset>
        </form>
    </div>

    <script>
        // 1. Escuta o evento 'submit' do formulário
        document.getElementById('formCadastrarPaciente').addEventListener('submit', function(event) {
            
            // 2. Impede o recarregamento padrão da página
            event.preventDefault();

            // 3. Pega os valores dos campos do formulário
            // (Agora todos os IDs existem!)
            const dadosParaEnviar = {
                nome: document.getElementById('nome').value,
                cpf: document.getElementById('cpf').value,
                data_nascimento: document.getElementById('data_nascimento').value,
                telefone: document.getElementById('telefone').value,
                email: document.getElementById('email').value,
                id_convenio: document.getElementById('convenio').value,
                logradouro: document.getElementById('logradouro').value,
                numero: document.getElementById('numero').value,
                complemento: document.getElementById('complemento').value,
                bairro: document.getElementById('bairro').value,
                cidade: document.getElementById('cidade').value,
                estado: document.getElementById('estado').value,
                cep: document.getElementById('cep').value
            };

            // 4. Envia os dados para a API Python (Flask)
            fetch('http://127.0.0.1:5000/api/cadastrar_paciente', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(dadosParaEnviar) // Converte o objeto JS em texto JSON
            })
            .then(response => response.json()) // Pega a resposta da API
            .then(data => {
                alert(data.message); // Mostra o alerta (ex: "Paciente cadastrado com sucesso!")
                
                if (data.message.includes("sucesso")) {
                    event.target.reset(); // Limpa o formulário
                    // window.location.href = 'dashbord_medico.html';
                }
            })
            .catch(error => {
                console.error('Erro na requisição:', error);
                alert('Erro ao conectar com o servidor. Verifique o console.');
            });
        });
    </script>
</body>
</html>